{% extends "layouts/base.html.twig" %}

{% block title %}Statistics - {{ app_name }}
{% endblock %}

{% block body %}
	<div class="container mt-4">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<h1>Statistics</h1>
		</div>

        <div class="mb-4">
            <form action="statistics" method="GET">
                <div class="row">
                    <div class="col-md-5 mb-3">
                        <label for="date_from" class="form-label">Date From</label>
                        <input type="date" class="form-control" id="date_from" name="date_from" required value="{{ query.date_from ?? '-7 days'|date('Y-m-d') }}">
                    </div>
                    <div class="col-md-5 mb-3">
                        <label for="date_to" class="form-label">Date To</label>
                        <input type="date" class="form-control" id="date_to" name="date_to" required value="{{ query.date_to ?? 'now'|date('Y-m-d') }}">
                    </div>
                </div>
                <div class="mb-3">
                    <button type="submit" class="btn btn-primary">Display Balance</button>
                </div>
            </form>
        </div>

		<div
			class="row">
			<!-- Top 10 Balance Chart -->
			<div class="col-md-6 mb-4">
				<div class="card shadow-sm">
					<div class="card-header">
						<h5 class="mb-0">Top 10 Clients by Balance</h5>
					</div>
					<div class="card-body">
						<canvas id="balanceChart"></canvas>
					</div>
				</div>
			</div>

			<!-- Top 10 Volume Chart -->
			<div class="col-md-6 mb-4">
				<div class="card shadow-sm">
					<div class="card-header">
						<h5 class="mb-0">Top 10 Clients by Transaction Volume</h5>
					</div>
					<div class="card-body">
						<canvas id="volumeChart"></canvas>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
            const balanceData = {{topClientsByBalance | json_encode | raw}};
            const volumeData = {{topClientsByVolume | json_encode | raw}};

            new Chart(document.getElementById('balanceChart'), {
                type: 'bar',
                data: {
                    labels: balanceData.map(c => c.name),
                    datasets: [{
                        label: 'Balance',
                        data: balanceData.map(c => c.balance),
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            new Chart(document.getElementById('volumeChart'), {
                type: 'bar',
                data: {
                    labels: volumeData.map(c => c.name),
                    datasets: [{
                        label: 'Total Volume',
                        data: volumeData.map(c => c.volume),
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
	    });
	</script>
{% endblock %}
